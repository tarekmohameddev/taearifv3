# Tenant API Documentation

## Overview
This documentation covers the tenant-related API endpoints and the User model used in the live editor system. The system allows tenants to manage their website pages and components through a live editor interface.

---

## User Model (`models/User.js`)

### Schema Structure
The User model is built using Mongoose and represents a tenant in the system. Each user/tenant can have multiple pages with various components.

#### Fields Description:

**Basic User Information:**
- `username` (String, Required, Unique): The unique identifier for the tenant, used as tenantId in API calls
- `websiteName` (String, Required, Unique): The display name of the website/tenant
- `email` (String, Required, Unique): User's email address for authentication
- `password` (String, Required): Hashed password for user authentication
- `firstName` (String, Required): User's first name
- `lastName` (String, Required): User's last name
- `phoneNumber` (String, Required): User's contact phone number

**Component Management:**
- `componentSettings` (Map of Maps): A nested Map structure that stores page-specific component data
  - Structure: `componentSettings[pageName][componentId] = componentData`
  - Each page contains multiple components identified by unique IDs
  - Component data includes: type, name, componentName, data, position
  - Default: Empty Map
- `globalComponentsData` (Object): Stores global components that appear across all pages
  - Typically includes header and footer components
  - Structure: `{ header: {...}, footer: {...} }`
  - Default: Empty object

#### Schema Features:
- Uses Mongoose's Map type for flexible key-value storage
- Implements model caching to prevent recompilation in development
- Supports nested Maps for component organization
- Mixed type allows flexible data storage for component properties

---

## API Endpoints

### 1. Save Pages API (`/api/tenant/save-pages`)

**Method:** POST

**Purpose:** Saves tenant page data and component settings to the database

#### Request Body:
```json
{
  "tenantId": "test46", // Required: Username of the tenant
  "pages": { // Required: Object containing page data
    "homepage": [
      {
        "id": "hero-rcio28wns", // Component unique identifier
        "type": "hero", // Component type
        "name": "Hero", // Component display name
        "componentName": "hero1", // Component class/function name
        "data": { // Component-specific data/props
          "visible": true,
          "height": {
            "desktop": "90vh",
            "tablet": "90vh",
            "mobile": "90vh"
          },
          "minHeight": {
            "desktop": "520px",
            "tablet": "520px",
            "mobile": "520px"
          },
          "background": {
            "image": "https://dalel-lovat.vercel.app/images/hero.webp",
            "alt": "صورة خلفية لغرفة معيشة حديثة",
            "overlay": {
              "enabled": true,
              "opacity": "0.45",
              "color": "#000000"
            }
          },
          "content": {
            "title": "ابحث عن عقارك المفضل مع مكتب دليل الجواء العقاري",
            "subtitle": "نحن هنا لتوفير أفضل الحلول العقارية لك",
            "font": {
              "title": {
                "family": "Inter",
                "size": {
                  "desktop": "5xl",
                  "tablet": "4xl",
                  "mobile": "2xl"
                },
                "weight": "extrabold",
                "color": "#ffffff",
                "lineHeight": "1.25"
              },
              "subtitle": {
                "family": "Inter",
                "size": {
                  "desktop": "2xl",
                  "tablet": "2xl",
                  "mobile": "2xl"
                },
                "weight": "normal",
                "color": "rgba(255, 255, 255, 0.85)"
              }
            },
            "alignment": "center",
            "maxWidth": "5xl",
            "paddingTop": "200px"
          },
          "searchForm": {
            "enabled": true,
            "position": "bottom",
            "offset": "32",
            "background": {
              "color": "#ffffff",
              "opacity": "1",
              "shadow": "2xl",
              "border": "1px solid rgba(0, 0, 0, 0.05)",
              "borderRadius": "lg"
            },
            "fields": {
              "purpose": {
                "enabled": true,
                "options": [
                  {
                    "value": "rent",
                    "label": "إيجار"
                  },
                  {
                    "value": "sell",
                    "label": "بيع"
                  }
                ],
                "default": "rent"
              },
              "city": {
                "enabled": true,
                "placeholder": "أدخل المدينة أو المنطقة",
                "icon": "MapPin"
              },
              "type": {
                "enabled": true,
                "placeholder": "نوع العقار",
                "icon": "Home",
                "options": [
                  "شقة",
                  "فيلا",
                  "دوبلكس",
                  "أرض",
                  "شاليه",
                  "مكتب"
                ]
              },
              "price": {
                "enabled": true,
                "placeholder": "السعر",
                "icon": "CircleDollarSign",
                "options": [
                  {
                    "id": "any",
                    "label": "أي سعر"
                  },
                  {
                    "id": "0-200k",
                    "label": "0 - 200 ألف"
                  },
                  {
                    "id": "200k-500k",
                    "label": "200 - 500 ألف"
                  },
                  {
                    "id": "500k-1m",
                    "label": "500 ألف - 1 مليون"
                  },
                  {
                    "id": "1m+",
                    "label": "أكثر من 1 مليون"
                  }
                ]
              },
              "keywords": {
                "enabled": true,
                "placeholder": "كلمات مفتاحية..."
              }
            },
            "responsive": {
              "desktop": "all-in-row",
              "tablet": "two-rows",
              "mobile": "stacked"
            }
          },
          "animations": {
            "title": {
              "enabled": true,
              "type": "fade-up",
              "duration": 600,
              "delay": 200
            },
            "subtitle": {
              "enabled": true,
              "type": "fade-up",
              "duration": 600,
              "delay": 400
            },
            "searchForm": {
              "enabled": true,
              "type": "fade-up",
              "duration": 600,
              "delay": 600
            }
          },
          "useStore": true,
          "variant": "hero-rcio28wns",
          "deviceType": "laptop"
        },
        "position": 0, // Component order/position
        "layout": { // Optional: Grid layout information
          "row": 0,
          "col": 0,
          "span": 2
        }
      }
      // ... more components
    ]
    // ... more pages
  },
  "globalComponentsData": { // Optional: Global components
    "header": {
      "visible": true,
      "position": {
        "type": "sticky",
        "top": 0,
        "zIndex": 50
      },
      "height": {
        "desktop": 96,
        "tablet": 80,
        "mobile": 64
      },
      "background": {
        "type": "solid",
        "opacity": "0.8",
        "blur": true,
        "colors": {
          "from": "#ffffff",
          "to": "#ffffff"
        }
      },
      "colors": {
        "text": "#1f2937",
        "link": "#6b7280",
        "linkHover": "#111827",
        "linkActive": "#059669",
        "icon": "#374151",
        "iconHover": "#1f2937",
        "border": "#e5e7eb",
        "accent": "#059669"
      },
      "logo": {
        "type": "image+text",
        "image": "https://dalel-lovat.vercel.app/images/logo.svg",
        "text": "dfsaf",
        "font": {
          "family": "Inter",
          "size": 24,
          "weight": "600"
        },
        "url": "/",
        "clickAction": "navigate"
      },
      "menu": [
        {
          "id": "home",
          "type": "link",
          "text": "الرئيسية",
          "url": "/"
        },
        {
          "id": "for-sale",
          "type": "link",
          "text": "للبيع",
          "url": "/for-sale"
        },
        {
          "id": "for-rent",
          "type": "link",
          "text": "للإيجار",
          "url": "/for-rent"
        },
        {
          "id": "about",
          "type": "link",
          "text": "من نحن",
          "url": "/about-us"
        },
        {
          "id": "contact",
          "type": "link",
          "text": "تواصل معنا",
          "url": "/contact-us"
        }
      ],
      "actions": {
        "search": {
          "enabled": false,
          "placeholder": "بحث..."
        },
        "user": {
          "showProfile": false,
          "showCart": false,
          "showWishlist": false,
          "showNotifications": false
        },
        "mobile": {
          "showLogo": true,
          "showLanguageToggle": false,
          "showSearch": false
        }
      },
      "responsive": {
        "breakpoints": {
          "mobile": 768,
          "tablet": 1024,
          "desktop": 1280
        },
        "mobileMenu": {
          "side": "right",
          "width": 320,
          "overlay": true
        }
      },
      "animations": {
        "menuItems": {
          "enabled": true,
          "duration": 200,
          "delay": 50
        },
        "mobileMenu": {
          "enabled": true,
          "duration": 300,
          "easing": "ease-in-out"
        }
      }
    },
    "footer": {
      "visible": true,
      "background": {
        "type": "color",
        "image": "https://dalel-lovat.vercel.app/images/footer/FooterImage.webp",
        "alt": "خلفية الفوتر",
        "color": "#1f2937",
        "gradient": {
          "enabled": false,
          "direction": "to-r",
          "startColor": "#1f2937",
          "endColor": "#374151",
          "middleColor": "#4b5563"
        },
        "overlay": {
          "enabled": true,
          "opacity": "0.7",
          "color": "#000000",
          "blendMode": "multiply"
        }
      },
      "layout": {
        "columns": "3",
        "spacing": "8",
        "padding": "16",
        "maxWidth": "7xl"
      },
      "content": {
        "companyInfo": {
          "enabled": true,
          "name": "مكتب دليل الجواءسسس",
          "description": "دليل الجواء العقاري يقدم لك أفضل الحلول العقارية بخبرة واحترافية لتلبية كافة احتياجاتك في البيع والإيجار مع ضمان تجربة مريحة وموثوقة",
          "tagline": "للخدمات العقارية",
          "logo": ""
        },
        "quickLinks": {
          "enabled": true,
          "title": "روابط مهمةس",
          "links": [
            {
              "text": "الرئيسيةسس",
              "url": "/"
            },
            {
              "text": "البيع",
              "url": "/for-sale"
            },
            {
              "text": "الإيجار",
              "url": "/for-rent"
            },
            {
              "text": "من نحن",
              "url": "/about-us"
            },
            {
              "text": "تواصل معنا",
              "url": "/contact-us"
            }
          ]
        },
        "contactInfo": {
          "enabled": true,
          "title": "معلومات التواصل",
          "address": "المملكة العربية السعودية - القصيم",
          "phone1": "0533150222",
          "phone2": "0537180774",
          "email": "guidealjwa22@gmail.com"
        },
        "socialMedia": {
          "enabled": true,
          "title": "وسائل التواصل الاجتماعي",
          "platforms": [
            {
              "name": "واتساب",
              "icon": "FaWhatsapp",
              "url": "#",
              "color": "#25D366"
            },
            {
              "name": "لينكد إن",
              "icon": "Linkedin",
              "url": "#",
              "color": "#0077B5"
            },
            {
              "name": "إنستغرام",
              "icon": "Instagram",
              "url": "#",
              "color": "#E4405F"
            },
            {
              "name": "تويتر",
              "icon": "Twitter",
              "url": "#",
              "color": "#1DA1F2"
            },
            {
              "name": "فيسبوك",
              "icon": "Facebook",
              "url": "#",
              "color": "#1877F2"
            }
          ]
        }
      },
      "footerBottom": {
        "enabled": true,
        "copyright": "© 2024 مكتب دليل الجواء للخدمات العقارية. جميع الحقوق محفوظة.",
        "legalLinks": [
          {
            "text": "سياسة الخصوصية",
            "url": "/privacy"
          },
          {
            "text": "الشروط والأحكام",
            "url": "/terms"
          }
        ]
      },
      "styling": {
        "colors": {
          "textPrimary": "#ffffff",
          "textSecondary": "#ffffff",
          "textMuted": "rgba(255, 255, 255, 0.7)",
          "accent": "#10b981",
          "border": "rgba(255, 255, 255, 0.2)"
        },
        "typography": {
          "titleSize": "xl",
          "titleWeight": "bold",
          "bodySize": "sm",
          "bodyWeight": "normal"
        },
        "spacing": {
          "sectionPadding": "16",
          "columnGap": "8",
          "itemGap": "3"
        },
        "effects": {
          "hoverTransition": "0.3s",
          "shadow": "none",
          "borderRadius": "none"
        }
      }
    }
  }
}
```

#### Response:
```json
{
  "success": true,
  "message": "Pages saved successfully. 1 empty page(s) deleted from database.",
  "tenantId": "test46",
  "pagesSaved": 1,
  "pagesDeleted": 1,
  "componentsSaved": 10
}
```

#### Functionality:
1. **Validation:** Ensures tenantId and pages are provided and valid
2. **Tenant Lookup:** Finds existing tenant by username
3. **Data Processing:** 
   - Sorts components by position
   - Organizes data into componentSettings structure
   - Handles global components separately
4. **Database Operations:**
   - Uses atomic $set operation for data consistency
   - Removes empty pages using $unset operation
   - Updates timestamp (updatedAt)
5. **Error Handling:** Comprehensive error handling with appropriate HTTP status codes

#### Key Features:
- **Atomic Updates:** All changes are applied in a single database operation
- **Empty Page Cleanup:** Automatically removes empty pages from database
- **Position Sorting:** Components are automatically sorted by position
- **Global Components:** Separate handling for site-wide components
- **Flexible Data Storage:** Supports any component data structure

---

### 2. Get Tenant API (`/api/tenant/getTenant`)

**Method:** POST

**Purpose:** Retrieves complete tenant data including all pages and components

#### Request Body:
```json
{
  "websiteName": "test46" // Required: Website name to lookup
}
```

#### Response:
```json
{
  "_id": "68ba080cad36c6aa319b4106",
  "username": "test46",
  "websiteName": "test46",
  "email": "test@46.test",
  "firstName": "test46",
  "lastName": "test46",
  "componentSettings": {
    "homepage": {
      "hero-rcio28wns": {
        "type": "hero",
        "name": "Hero",
        "componentName": "hero1",
        "data": {
          "visible": true,
          "height": {
            "desktop": "90vh",
            "tablet": "90vh",
            "mobile": "90vh"
          },
          "minHeight": {
            "desktop": "520px",
            "tablet": "520px",
            "mobile": "520px"
          },
          "background": {
            "image": "https://dalel-lovat.vercel.app/images/hero.webp",
            "alt": "صورة خلفية لغرفة معيشة حديثة",
            "overlay": {
              "enabled": true,
              "opacity": "0.45",
              "color": "#000000"
            }
          },
          "content": {
            "title": "ابحث عن عقارك المفضل مع مكتب دليل الجواء العقاري",
            "subtitle": "نحن هنا لتوفير أفضل الحلول العقارية لك",
            "font": {
              "title": {
                "family": "Inter",
                "size": {
                  "desktop": "5xl",
                  "tablet": "4xl",
                  "mobile": "2xl"
                },
                "weight": "extrabold",
                "color": "#ffffff",
                "lineHeight": "1.25"
              },
              "subtitle": {
                "family": "Inter",
                "size": {
                  "desktop": "2xl",
                  "tablet": "2xl",
                  "mobile": "2xl"
                },
                "weight": "normal",
                "color": "rgba(255, 255, 255, 0.85)"
              }
            },
            "alignment": "center",
            "maxWidth": "5xl",
            "paddingTop": "200px"
          },
          "searchForm": {
            "enabled": true,
            "position": "bottom",
            "offset": "32",
            "background": {
              "color": "#ffffff",
              "opacity": "1",
              "shadow": "2xl",
              "border": "1px solid rgba(0, 0, 0, 0.05)",
              "borderRadius": "lg"
            },
            "fields": {
              "purpose": {
                "enabled": true,
                "options": [
                  {
                    "value": "rent",
                    "label": "إيجار"
                  },
                  {
                    "value": "sell",
                    "label": "بيع"
                  }
                ],
                "default": "rent"
              },
              "city": {
                "enabled": true,
                "placeholder": "أدخل المدينة أو المنطقة",
                "icon": "MapPin"
              },
              "type": {
                "enabled": true,
                "placeholder": "نوع العقار",
                "icon": "Home",
                "options": [
                  "شقة",
                  "فيلا",
                  "دوبلكس",
                  "أرض",
                  "شاليه",
                  "مكتب"
                ]
              },
              "price": {
                "enabled": true,
                "placeholder": "السعر",
                "icon": "CircleDollarSign",
                "options": [
                  {
                    "id": "any",
                    "label": "أي سعر"
                  },
                  {
                    "id": "0-200k",
                    "label": "0 - 200 ألف"
                  },
                  {
                    "id": "200k-500k",
                    "label": "200 - 500 ألف"
                  },
                  {
                    "id": "500k-1m",
                    "label": "500 ألف - 1 مليون"
                  },
                  {
                    "id": "1m+",
                    "label": "أكثر من 1 مليون"
                  }
                ]
              },
              "keywords": {
                "enabled": true,
                "placeholder": "كلمات مفتاحية..."
              }
            },
            "responsive": {
              "desktop": "all-in-row",
              "tablet": "two-rows",
              "mobile": "stacked"
            }
          },
          "animations": {
            "title": {
              "enabled": true,
              "type": "fade-up",
              "duration": 600,
              "delay": 200
            },
            "subtitle": {
              "enabled": true,
              "type": "fade-up",
              "duration": 600,
              "delay": 400
            },
            "searchForm": {
              "enabled": true,
              "type": "fade-up",
              "duration": 600,
              "delay": 600
            }
          },
          "useStore": true,
          "variant": "hero-rcio28wns",
          "deviceType": "laptop"
        },
        "position": 0
      }
      // ... more components for homepage
    },
    "for-rent": {
      "4ae1553b-b67d-4446-a7e0-6157299c24dc": {
        "type": "header",
        "name": "Header",
        "componentName": "header1",
        "data": {
          "visible": true,
          "position": {
            "type": "sticky",
            "top": 0,
            "zIndex": 50
          },
          "height": {
            "desktop": 96,
            "tablet": 80,
            "mobile": 64
          },
          "background": {
            "type": "solid",
            "opacity": "0.8",
            "blur": true,
            "colors": {
              "from": "#ffffff",
              "to": "#ffffff"
            }
          },
          "colors": {
            "text": "#1f2937",
            "link": "#374151",
            "linkHover": "#1f2937",
            "linkActive": "#059669",
            "icon": "#374151",
            "iconHover": "#1f2937",
            "border": "#e5e7eb",
            "accent": "#059669"
          },
          "logo": {
            "type": "image+text",
            "image": "https://dalel-lovat.vercel.app/images/logo.svg",
            "text": "مكتب دليل الجواء",
            "font": {
              "family": "Inter",
              "size": 24,
              "weight": "600"
            },
            "url": "/",
            "clickAction": "navigate"
          },
          "menu": [
            {
              "id": "home",
              "type": "link",
              "text": "الرئيسية",
              "url": "/"
            },
            {
              "id": "about",
              "type": "link",
              "text": "حول",
              "url": "/about"
            },
            {
              "id": "services",
              "type": "link",
              "text": "الخدمات",
              "url": "/services"
            },
            {
              "id": "contact",
              "type": "link",
              "text": "اتصل بنا",
              "url": "/contact"
            }
          ],
          "actions": {
            "search": {
              "enabled": false,
              "placeholder": "بحث..."
            },
            "user": {
              "showProfile": true,
              "showCart": false,
              "showWishlist": false,
              "showNotifications": false
            },
            "mobile": {
              "showLogo": true,
              "showLanguageToggle": false,
              "showSearch": false
            }
          },
          "responsive": {
            "breakpoints": {
              "mobile": 768,
              "tablet": 1024,
              "desktop": 1280
            },
            "mobileMenu": {
              "side": "right",
              "width": 320,
              "overlay": true
            }
          },
          "animations": {
            "menuItems": {
              "enabled": true,
              "duration": 200,
              "delay": 50
            },
            "mobileMenu": {
              "enabled": true,
              "duration": 300,
              "easing": "ease-in-out"
            }
          }
        },
        "position": 0
      }
      // ... more components for for-rent page
    }
    // ... more pages (for-sale, about-us, contact-us)
  },
  "globalComponentsData": {
    "header": {
      "visible": true,
      "position": {
        "type": "sticky",
        "top": 0,
        "zIndex": 50
      },
      "height": {
        "desktop": 96,
        "tablet": 80,
        "mobile": 64
      },
      "background": {
        "type": "solid",
        "opacity": "0.8",
        "blur": true,
        "colors": {
          "from": "#ffffff",
          "to": "#ffffff"
        }
      },
      "colors": {
        "text": "#1f2937",
        "link": "#6b7280",
        "linkHover": "#111827",
        "linkActive": "#059669",
        "icon": "#374151",
        "iconHover": "#1f2937",
        "border": "#e5e7eb",
        "accent": "#059669"
      },
      "logo": {
        "type": "image+text",
        "image": "https://dalel-lovat.vercel.app/images/logo.svg",
        "text": "dfsaf",
        "font": {
          "family": "Inter",
          "size": 24,
          "weight": "600"
        },
        "url": "/",
        "clickAction": "navigate"
      },
      "menu": [
        {
          "id": "home",
          "type": "link",
          "text": "الرئيسية",
          "url": "/"
        },
        {
          "id": "for-sale",
          "type": "link",
          "text": "للبيع",
          "url": "/for-sale"
        },
        {
          "id": "for-rent",
          "type": "link",
          "text": "للإيجار",
          "url": "/for-rent"
        },
        {
          "id": "about",
          "type": "link",
          "text": "من نحن",
          "url": "/about-us"
        },
        {
          "id": "contact",
          "type": "link",
          "text": "تواصل معنا",
          "url": "/contact-us"
        }
      ],
      "actions": {
        "search": {
          "enabled": false,
          "placeholder": "بحث..."
        },
        "user": {
          "showProfile": false,
          "showCart": false,
          "showWishlist": false,
          "showNotifications": false
        },
        "mobile": {
          "showLogo": true,
          "showLanguageToggle": false,
          "showSearch": false
        }
      },
      "responsive": {
        "breakpoints": {
          "mobile": 768,
          "tablet": 1024,
          "desktop": 1280
        },
        "mobileMenu": {
          "side": "right",
          "width": 320,
          "overlay": true
        }
      },
      "animations": {
        "menuItems": {
          "enabled": true,
          "duration": 200,
          "delay": 50
        },
        "mobileMenu": {
          "enabled": true,
          "duration": 300,
          "easing": "ease-in-out"
        }
      }
    },
    "footer": {
      "visible": true,
      "background": {
        "type": "color",
        "image": "https://dalel-lovat.vercel.app/images/footer/FooterImage.webp",
        "alt": "خلفية الفوتر",
        "color": "#1f2937",
        "gradient": {
          "enabled": false,
          "direction": "to-r",
          "startColor": "#1f2937",
          "endColor": "#374151",
          "middleColor": "#4b5563"
        },
        "overlay": {
          "enabled": true,
          "opacity": "0.7",
          "color": "#000000",
          "blendMode": "multiply"
        }
      },
      "layout": {
        "columns": "3",
        "spacing": "8",
        "padding": "16",
        "maxWidth": "7xl"
      },
      "content": {
        "companyInfo": {
          "enabled": true,
          "name": "مكتب دليل الجواءسسس",
          "description": "دليل الجواء العقاري يقدم لك أفضل الحلول العقارية بخبرة واحترافية لتلبية كافة احتياجاتك في البيع والإيجار مع ضمان تجربة مريحة وموثوقة",
          "tagline": "للخدمات العقارية",
          "logo": ""
        },
        "quickLinks": {
          "enabled": true,
          "title": "روابط مهمةس",
          "links": [
            {
              "text": "الرئيسيةسس",
              "url": "/"
            },
            {
              "text": "البيع",
              "url": "/for-sale"
            },
            {
              "text": "الإيجار",
              "url": "/for-rent"
            },
            {
              "text": "من نحن",
              "url": "/about-us"
            },
            {
              "text": "تواصل معنا",
              "url": "/contact-us"
            }
          ]
        },
        "contactInfo": {
          "enabled": true,
          "title": "معلومات التواصل",
          "address": "المملكة العربية السعودية - القصيم",
          "phone1": "0533150222",
          "phone2": "0537180774",
          "email": "guidealjwa22@gmail.com"
        },
        "socialMedia": {
          "enabled": true,
          "title": "وسائل التواصل الاجتماعي",
          "platforms": [
            {
              "name": "واتساب",
              "icon": "FaWhatsapp",
              "url": "#",
              "color": "#25D366"
            },
            {
              "name": "لينكد إن",
              "icon": "Linkedin",
              "url": "#",
              "color": "#0077B5"
            },
            {
              "name": "إنستغرام",
              "icon": "Instagram",
              "url": "#",
              "color": "#E4405F"
            },
            {
              "name": "تويتر",
              "icon": "Twitter",
              "url": "#",
              "color": "#1DA1F2"
            },
            {
              "name": "فيسبوك",
              "icon": "Facebook",
              "url": "#",
              "color": "#1877F2"
            }
          ]
        }
      },
      "footerBottom": {
        "enabled": true,
        "copyright": "© 2024 مكتب دليل الجواء للخدمات العقارية. جميع الحقوق محفوظة.",
        "legalLinks": [
          {
            "text": "سياسة الخصوصية",
            "url": "/privacy"
          },
          {
            "text": "الشروط والأحكام",
            "url": "/terms"
          }
        ]
      },
      "styling": {
        "colors": {
          "textPrimary": "#ffffff",
          "textSecondary": "#ffffff",
          "textMuted": "rgba(255, 255, 255, 0.7)",
          "accent": "#10b981",
          "border": "rgba(255, 255, 255, 0.2)"
        },
        "typography": {
          "titleSize": "xl",
          "titleWeight": "bold",
          "bodySize": "sm",
          "bodyWeight": "normal"
        },
        "spacing": {
          "sectionPadding": "16",
          "columnGap": "8",
          "itemGap": "3"
        },
        "effects": {
          "hoverTransition": "0.3s",
          "shadow": "none",
          "borderRadius": "none"
        }
      }
    }
  },
  "__v": 0
}
```

#### Functionality:
1. **Validation:** Ensures websiteName is provided
2. **Database Query:** Finds tenant by username (websiteName)
3. **Data Transformation:** Converts Mongoose document to plain object
4. **Security:** Excludes sensitive fields (password, phoneNumber)
5. **Error Handling:** Returns appropriate status codes for different scenarios

#### Key Features:
- **Complete Data Retrieval:** Returns all tenant data in one request
- **Security:** Sensitive information is excluded from response
- **Flexible Response:** Uses Mongoose's toObject() for clean data structure
- **Error Handling:** Proper HTTP status codes (204 for not found, 500 for server errors)

---

## Real-World Data Structure Analysis

Based on the actual request/response examples, the system supports a comprehensive set of component types and data structures:

### Component Types Supported:
1. **hero** - Hero sections with background images, titles, subtitles, and search forms
2. **halfTextHalfImage** - Text and image sections with various layouts
3. **propertySlider** - Property carousels with multiple properties
4. **ctaValuation** - Call-to-action sections for property valuation
5. **stepsSection** - Step-by-step process sections
6. **header** - Navigation headers with menus and logos
7. **footer** - Site footers with company info, links, and social media
8. **propertyFilter** - Property filtering components
9. **filterButtons** - Filter button groups
10. **grid** - Property grid layouts
11. **testimonials** - Customer testimonial sections
12. **whyChooseUs** - Why choose us sections
13. **contactCards** - Contact information cards
14. **contactFormSection** - Contact form sections
15. **mapSection** - Map display sections

### Key Data Structure Features:

#### Component Data Properties:
- **visible**: Boolean to show/hide components
- **responsive**: Device-specific configurations (desktop, tablet, mobile)
- **animations**: Animation configurations with types, durations, and delays
- **styling**: Color schemes, typography, spacing, and effects
- **layout**: Grid positioning, directions, and responsive behavior
- **content**: Text content, images, buttons, and form fields
- **useStore**: Boolean indicating if component uses global state
- **variant**: Unique component variant identifier
- **deviceType**: Current device type for responsive behavior

#### Global Components:
- **Header**: Sticky navigation with logo, menu, and responsive behavior
- **Footer**: Multi-column layout with company info, links, and social media

#### Page Structure:
- Multiple pages supported: `homepage`, `for-rent`, `for-sale`, `about-us`, `contact-us`
- Each page contains an array of components with unique IDs
- Components are positioned using `position` property for ordering
- Grid layout information stored in `layout` property

#### Advanced Features:
- **Responsive Design**: Each component supports desktop, tablet, and mobile configurations
- **Animation System**: Fade-up animations with configurable timing
- **Form Integration**: Search forms with multiple field types and validation
- **Image Management**: Background images with overlays and alt text
- **Typography System**: Font families, sizes, weights, and colors
- **Color System**: Comprehensive color schemes for text, backgrounds, and accents

---

## Future API Enhancements

### Single Page Retrieval Endpoints

The current system retrieves all tenant data at once. Future enhancements should include endpoints for retrieving individual pages to improve performance and reduce data transfer.

#### Proposed Implementation Options:

**Option 1: Enhanced getTenant with Page Filter**
```
POST /api/tenant/getTenant
Body: {
  "websiteName": "string",
  "pageId": "string" // Optional: specific page to retrieve
}
```
- If pageId provided: Returns only that page + globalComponentsData
- If pageId omitted: Returns all pages (current behavior)

**Option 2: Dedicated Single Page Endpoint**
```
GET /api/tenant/[tenantId]/pages/[pageId]
```
- Direct URL-based access
- Always includes globalComponentsData
- More RESTful approach
- Better for caching and CDN integration

**Option 3: Query Parameter Approach**
```
GET /api/tenant/[tenantId]/pages?pageId=homepage
```
- Flexible query parameters
- Can support multiple page IDs in future
- Easy to extend with additional filters

#### Recommended Approach:
Implement **Option 2** as it provides:
- Clear separation of concerns
- Better performance for single page loads
- RESTful API design
- Easier caching strategies
- Future extensibility

#### Implementation Details:
```javascript
// GET /api/tenant/[tenantId]/pages/[pageId]
export default async function handler(req, res) {
  const { tenantId, pageId } = req.query;
  
  // Always include globalComponentsData
  const tenant = await User.findOne({ username: tenantId })
    .select('componentSettings globalComponentsData');
    
  const pageData = tenant.componentSettings.get(pageId);
  const globalComponents = tenant.globalComponentsData;
  
  return res.json({
    pageId,
    pageData,
    globalComponentsData: globalComponents
  });
}
```

---

## Database Schema Considerations

### Current Structure:
- Uses MongoDB with Mongoose ODM
- Nested Maps for flexible component storage
- Global components stored separately
- Username as primary identifier

### Performance Optimizations:
1. **Indexing:** Ensure username field is indexed for fast lookups
2. **Pagination:** Consider pagination for tenants with many pages
3. **Caching:** Implement Redis caching for frequently accessed data
4. **Data Compression:** Consider compressing large component data

### Security Considerations:
1. **Input Validation:** All inputs should be validated and sanitized
2. **Access Control:** Implement proper authentication and authorization
3. **Rate Limiting:** Prevent abuse of save operations
4. **Data Integrity:** Validate component data structure before saving

---

## Error Handling

### Common Error Scenarios:
1. **400 Bad Request:** Missing required fields, invalid data types
2. **404 Not Found:** Tenant doesn't exist
3. **405 Method Not Allowed:** Wrong HTTP method
4. **500 Internal Server Error:** Database connection issues, server errors

### Error Response Format:
```json
{
  "message": "Error description",
  "error": "Detailed error information"
}
```

---

## Usage Examples

### Saving a Page with Components:
```javascript
const response = await fetch('/api/tenant/save-pages', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    tenantId: 'mywebsite',
    pages: {
      'homepage': [
        {
          id: 'hero-1',
          type: 'hero',
          name: 'Hero Section',
          componentName: 'HeroSection',
          data: { title: 'Welcome', subtitle: 'To our website' },
          position: 0
        }
      ]
    },
    globalComponentsData: {
      header: { logo: 'logo.png', menu: [...] },
      footer: { copyright: '2024', links: [...] }
    }
  })
});
```

### Retrieving Tenant Data:
```javascript
const response = await fetch('/api/tenant/getTenant', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    websiteName: 'mywebsite'
  })
});
```

---

## Conclusion

The current tenant API system provides a solid foundation for managing multi-page websites with component-based architecture. The proposed enhancements for single-page retrieval will significantly improve performance and user experience, especially for large websites with many pages and components.

The system's flexibility allows for easy extension and modification while maintaining data integrity and performance. Future development should focus on implementing the single-page retrieval endpoints and optimizing database queries for better scalability.
