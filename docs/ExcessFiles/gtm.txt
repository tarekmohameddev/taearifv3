components\GTMProvider.tsx code : (""use client";

import { useEffect } from "react";
import { usePathname, useSearchParams } from "next/navigation";
import Script from "next/script";

declare global {
  interface Window {
    dataLayer: any[];
    gtag: (...args: any[]) => void;
  }
}

interface GTMProviderProps {
  children: React.ReactNode;
  containerId: string;
}

export function GTMProvider({ children, containerId }: GTMProviderProps) {
  const pathname = usePathname();
  const searchParams = useSearchParams();

  // Initialize GTM dataLayer
  useEffect(() => {
    if (typeof window !== "undefined") {
      window.dataLayer = window.dataLayer || [];
      window.gtag = window.gtag || function() {
        window.dataLayer.push(arguments);
      };
    }
  }, []);

  // Track page views on route changes
  useEffect(() => {
    if (typeof window !== "undefined" && window.gtag) {
      const url = pathname + (searchParams.toString() ? `?${searchParams.toString()}` : '');
      
      window.gtag('config', containerId, {
        page_path: url,
        page_title: document.title,
      });
    }
  }, [pathname, searchParams, containerId]);

  return (
    <>
      {/* GTM Script - Only load if not already loaded in root layout */}
      {typeof window !== "undefined" && !window.dataLayer && (
        <Script
          id="gtm-script"
          strategy="afterInteractive"
          dangerouslySetInnerHTML={{
            __html: `
              (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
              new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
              j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
              'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
              })(window,document,'script','dataLayer','${containerId}');
            `,
          }}
        />
      )}
      {children}
    </>
  );
}
")



app\dashboard\layout.tsx code : (""use client";

import { useEffect } from "react";
import { useTokenValidation } from "@/hooks/useTokenValidation";
import { GTMProvider } from "@/components/GTMProvider";
import { GTMTest } from "@/components/GTMTest";

/*
 * ========================================
 * DASHBOARD LAYOUT - ARABIC RTL ENFORCEMENT
 * ========================================
 * 
 * This layout component is specifically designed for Arabic RTL dashboard pages.
 * 
 * PURPOSE:
 * - Enforces RTL (Right-to-Left) direction for all dashboard pages
 * - Ensures consistent Arabic language experience
 * - Applies RTL styling automatically to all dashboard content
 * 
 * HOW IT WORKS:
 * 1. Automatically applies RTL direction to HTML, body, and all elements
 * 2. Validates user authentication before rendering content
 * 3. Provides loading state during token validation
 * 
 * NOTE:
 * This layout works in conjunction with middleware.ts which automatically
 * redirects all dashboard pages to Arabic locale (/ar/dashboard/*)
 * 
 * MODIFICATION NOTES:
 * - To disable RTL enforcement: Remove the useEffect with RTL styling
 * - To change language direction: Modify the direction CSS properties
 * - To add LTR support: Add conditional logic based on locale detection
 */

export default function DashboardLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  // Token validation
  const { tokenValidation } = useTokenValidation();

  useEffect(() => {
    // Ø¥Ø¶Ø§ÙØ© CSS Ù„Ø¶Ù…Ø§Ù† RTL
    const style = document.createElement("style");
    style.id = "dashboard-rtl-styles";
    style.textContent = `
      html {
        direction: rtl !important;
      }
      body {
        direction: rtl !important;
      }
      * {
        direction: rtl !important;
      }
    `;
    document.head.appendChild(style);

    console.log("ðŸ”„ Dashboard Layout: Applied RTL styling");

    // ØªÙ†Ø¸ÙŠÙ Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ø¬Ù„Ø¯
    return () => {
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù€ CSS
      const styleElement = document.getElementById("dashboard-rtl-styles");
      if (styleElement) {
        styleElement.remove();
      }

      console.log("ðŸ”„ Dashboard Layout: Removed RTL styling");
    };
  }, []);

  // Show loading while validating token
  if (tokenValidation.loading) {
    return (
      <div
        className="min-h-screen flex items-center justify-center bg-gray-50"
        dir="rtl"
      >
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
          <p className="text-gray-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¬Ù„Ø³Ø©...</p>
        </div>
      </div>
    );
  }

  return (
    <GTMProvider containerId="GTM-KBL37C9T">
      <div dir="rtl" style={{ direction: "rtl" }}>
        {children}
        {/* GTM Test Component - Remove in production */}
        <GTMTest />
      </div>
    </GTMProvider>
  );
}
")

components\GTMTest.tsx code : (""use client";

import { useEffect, useState } from "react";
import { trackEvent, trackPageView } from "@/lib/gtm";

export function GTMTest() {
  const [gtmStatus, setGtmStatus] = useState<string>("Checking...");

  useEffect(() => {
    // Check if GTM is loaded
    const checkGTM = () => {
      if (typeof window !== "undefined") {
        if (window.dataLayer && window.gtag) {
          setGtmStatus("âœ… GTM is loaded and ready!");
          
          // Test page view tracking
          trackPageView("/test", "GTM Test Page");
          
          // Test event tracking
          trackEvent("gtm_test", {
            test_type: "component_load",
            timestamp: new Date().toISOString(),
          });
        } else if (window.dataLayer) {
          setGtmStatus("âš ï¸ DataLayer exists but gtag not ready");
        } else {
          setGtmStatus("âŒ GTM not detected");
        }
      }
    };

    // Check immediately
    checkGTM();

    // Check again after a short delay
    const timeout = setTimeout(checkGTM, 1000);
    
    return () => clearTimeout(timeout);
  }, []);

  const testEvent = () => {
    trackEvent("button_click", {
      button_name: "gtm_test_button",
      page: "gtm_test",
    });
    alert("Test event sent! Check your GTM container.");
  };

  return (
    <div className="fixed bottom-4 right-4 bg-white border border-gray-300 rounded-lg p-4 shadow-lg z-50 max-w-sm">
      <h3 className="font-semibold text-sm mb-2">GTM Status</h3>
      <p className="text-xs mb-3">{gtmStatus}</p>
      
      <div className="space-y-2">
        <button
          onClick={testEvent}
          className="w-full bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600"
        >
          Test Event
        </button>
        
        <div className="text-xs text-gray-600">
          <p>Container: GTM-KBL37C9T</p>
          <p>Check Tag Assistant for verification</p>
        </div>
      </div>
    </div>
  );
}
")