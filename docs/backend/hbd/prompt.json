{
  "project_info": {
    "api_endpoint": "/api/v1/rms/dashboard",
    "scope": "Backend only - API response modifications",
    "note": "Frontend is in different project, only backend changes needed"
  },
  "current_response_structure": {
    "status": true,
    "data": {
      "range_days": 7,
      "counts": {
        "ongoing_rentals": 26,
        "expiring_contracts_next_7d": 0,
        "payments_due_next_7d": 0,
        "payments_overdue": 0,
        "maintenance_open": 2,
        "maintenance_in_progress": 0
      },
      "property_stats": {},
      "contract_stats": {},
      "monthly_collections": {},
      "yearly_overview": {},
      "contracts_expiring": {},
      "ongoing_rentals": [],
      "reminders": [],
      "maintenance": []
    }
  },
  "execution_rules": {
    "strict_sequential_execution": true,
    "rule_1": "Execute ONLY ONE task at a time",
    "rule_2": "Do NOT proceed to next task until explicitly told to continue",
    "rule_3": "Wait for user command 'اكمل وادخل في الtask التي بعدها' before moving to next task",
    "rule_4": "Complete current task fully before asking for permission to continue",
    "rule_5": "If user says 'اكمل' or 'continue', then proceed to next task"
  },
  "tasks": {
    "task_1": {
      "id": 1,
      "title": "Add payments due next month count",
      "description": "Add new count field for payments due in the next complete month (not 30 days, but actual month like November, December)",
      "field_to_add": "payments_due_next_month",
      "location": "data.counts",
      "status": "pending",
      "current_counts_structure": {
        "ongoing_rentals": 26,
        "expiring_contracts_next_7d": 0,
        "payments_due_next_7d": 0,
        "payments_overdue": 0,
        "maintenance_open": 2,
        "maintenance_in_progress": 0
      },
      "new_counts_structure": {
        "ongoing_rentals": 26,
        "expiring_contracts_next_7d": 0,
        "payments_due_next_7d": 0,
        "payments_due_next_month": 0,
        "payments_overdue": 0,
        "maintenance_open": 2,
        "maintenance_in_progress": 0
      },
      "completion_message": "Task 1 completed. Wait for user command 'اكمل وادخل في الtask التي بعدها' before proceeding to Task 2."
    },
    "task_2": {
      "id": 2,
      "title": "Add contracts expiring current month count",
      "description": "Add count for contracts that will expire in the current complete month (not 30 days, but actual month)",
      "field_to_add": "expiring_contracts_current_month",
      "location": "data.counts",
      "status": "blocked",
      "note": "This should show contracts ending in the current month (like October 2025)",
      "completion_message": "Task 2 completed. Wait for user command 'اكمل وادخل في الtask التي بعدها' before proceeding to Task 3."
    },
    "task_3": {
      "id": 3,
      "title": "Add contracts expiring next month count",
      "description": "Add count for contracts that will expire in the next complete month",
      "field_to_add": "expiring_contracts_next_month",
      "location": "data.counts",
      "status": "blocked",
      "note": "This should show contracts ending in the next month (like November 2025)",
      "completion_message": "Task 3 completed. Wait for user command 'اكمل وادخل في الtask التي بعدها' before proceeding to Task 4."
    },
    "task_4": {
      "id": 4,
      "title": "Add payments due current month count",
      "description": "Add count for payments due in the current complete month (not 30 days, but actual month)",
      "field_to_add": "payments_due_current_month",
      "location": "data.counts",
      "status": "blocked",
      "note": "This should show payments due in the current month (like October 2025)",
      "completion_message": "Task 4 completed. Wait for user command 'اكمل وادخل في الtask التي بعدها' before proceeding to Task 5."
    },
    "task_5": {
      "id": 5,
      "title": "CRITICAL: Fix existing monthly collection calculations",
      "description": "Review and fix total_to_collect_this_month and total_to_collect_next_month to use actual months not 30-day periods",
      "fields_to_fix": [
        "total_to_collect_this_month",
        "total_to_collect_next_month"
      ],
      "location": "monthly_collections",
      "status": "blocked",
      "current_issue": "Currently calculated using 30-day periods from current date (WRONG)",
      "required_fix": "Change to actual month boundaries (October 2025, November 2025, etc.)",
      "example": "If today is October 15, 2025: this_month = October 1-31, next_month = November 1-30",
      "completion_message": "Task 5 completed. Wait for user command 'اكمل وادخل في الtask التي بعدها' before proceeding to Task 6."
    },
    "task_6": {
      "id": 6,
      "title": "Add detailed payments due next month object",
      "description": "Create new object outside counts containing detailed information for payments due in the next complete month",
      "new_object_name": "payments_due_next_month_details",
      "location": "data (same level as counts)",
      "status": "blocked",
      "purpose": "Provide detailed information for each payment that contributes to counts.payments_due_next_month",
      "object_structure": {
        "month": "November 2025",
        "count": 0,
        "total_amount": 0,
        "paid_count": 0,
        "paid_amount": 0,
        "unpaid_count": 0,
        "unpaid_amount": 0,
        "payments": [
          {
            "rental_id": 123,
            "tenant_name": "John Doe",
            "tenant_phone": "+966501234567",
            "property": {
              "id": 45,
              "name": "Apartment A-12",
              "unit_label": "Unit 12"
            },
            "contract": {
              "id": 67,
              "end_date": "2026-05-15",
              "status": "active"
            },
            "payment_details": {
              "amount": 5000.0,
              "due_date": "2025-11-15",
              "currency": "SAR",
              "payment_type": "monthly_rent",
              "payment_status": "paid",
              "paid_date": "2025-11-10",
              "payment_method": "bank_transfer"
            },
            "days_remaining": 15
          }
        ]
      },
      "data_source": "Same data used to calculate counts.payments_due_next_month but with full details",
      "completion_message": "Task 6 completed. Wait for user command 'اكمل وادخل في الtask التي بعدها' before proceeding to Task 7."
    },
    "task_7": {
      "id": 7,
      "title": "Add detailed contracts expiring current month object",
      "description": "Create new object outside counts containing detailed information for contracts that will expire in the current complete month",
      "new_object_name": "expiring_contracts_current_month_details",
      "location": "data (same level as counts)",
      "status": "blocked",
      "purpose": "Provide detailed information for each contract that contributes to counts.expiring_contracts_current_month",
      "object_structure": {
        "month": "October 2025",
        "count": 0,
        "contracts": [
          {
            "rental_id": 123,
            "tenant_name": "John Doe",
            "tenant_phone": "+966501234567",
            "tenant_email": "john.doe@email.com",
            "property": {
              "id": 45,
              "name": "Apartment A-12",
              "unit_label": "Unit 12",
              "address": "123 Main Street, Riyadh"
            },
            "contract": {
              "id": 67,
              "start_date": "2024-10-15",
              "end_date": "2025-10-15",
              "status": "active",
              "monthly_rent": 5000.0,
              "security_deposit": 10000.0,
              "contract_duration_months": 12
            },
            "rental_details": {
              "rental_amount": 5000.0,
              "currency": "SAR",
              "payment_frequency": "monthly",
              "next_payment_due": "2025-10-15"
            },
            "days_remaining": 5,
            "renewal_status": "pending"
          }
        ]
      },
      "data_source": "Same data used to calculate counts.expiring_contracts_current_month but with full details",
      "completion_message": "Task 7 completed. Wait for user command 'اكمل وادخل في الtask التي بعدها' before proceeding to Task 8."
    },
    "task_8": {
      "id": 8,
      "title": "Add detailed contracts expiring next month object",
      "description": "Create new object outside counts containing detailed information for contracts that will expire in the next complete month",
      "new_object_name": "expiring_contracts_next_month_details",
      "location": "data (same level as counts)",
      "status": "blocked",
      "purpose": "Provide detailed information for each contract that contributes to counts.expiring_contracts_next_month",
      "object_structure": {
        "month": "November 2025",
        "count": 0,
        "contracts": [
          {
            "rental_id": 124,
            "tenant_name": "Jane Smith",
            "tenant_phone": "+966501234568",
            "tenant_email": "jane.smith@email.com",
            "property": {
              "id": 46,
              "name": "Apartment B-15",
              "unit_label": "Unit 15",
              "address": "456 King Street, Riyadh"
            },
            "contract": {
              "id": 68,
              "start_date": "2024-11-15",
              "end_date": "2025-11-15",
              "status": "active",
              "monthly_rent": 6000.0,
              "security_deposit": 12000.0,
              "contract_duration_months": 12
            },
            "rental_details": {
              "rental_amount": 6000.0,
              "currency": "SAR",
              "payment_frequency": "monthly",
              "next_payment_due": "2025-11-15"
            },
            "days_remaining": 30,
            "renewal_status": "not_requested"
          }
        ]
      },
      "data_source": "Same data used to calculate counts.expiring_contracts_next_month but with full details",
      "completion_message": "Task 8 completed. Wait for user command 'اكمل وادخل في الtask التي بعدها' before proceeding to Task 9."
    },
    "task_9": {
      "id": 9,
      "title": "Add detailed payments due current month object",
      "description": "Create new object outside counts containing detailed information for payments due in the current complete month",
      "new_object_name": "payments_due_current_month_details",
      "location": "data (same level as counts)",
      "status": "blocked",
      "purpose": "Provide detailed information for each payment that contributes to counts.payments_due_current_month",
      "object_structure": {
        "month": "October 2025",
        "count": 0,
        "total_amount": 0,
        "paid_count": 0,
        "paid_amount": 0,
        "unpaid_count": 0,
        "unpaid_amount": 0,
        "payments": [
          {
            "rental_id": 125,
            "tenant_name": "Ahmed Ali",
            "tenant_phone": "+966501234569",
            "tenant_email": "ahmed.ali@email.com",
            "property": {
              "id": 47,
              "name": "Apartment C-20",
              "unit_label": "Unit 20",
              "address": "789 Prince Street, Riyadh"
            },
            "contract": {
              "id": 69,
              "start_date": "2024-10-15",
              "end_date": "2025-10-15",
              "status": "active"
            },
            "payment_details": {
              "amount": 7000.0,
              "due_date": "2025-10-15",
              "currency": "SAR",
              "payment_type": "monthly_rent",
              "payment_status": "unpaid",
              "paid_date": null,
              "payment_method": null
            },
            "days_remaining": 5
          }
        ]
      },
      "data_source": "Same data used to calculate counts.payments_due_current_month but with full details",
      "completion_message": "Task 9 completed. Wait for user command 'اكمل وادخل في الtask التي بعدها' before proceeding to Task 10."
    },
    "task_10": {
      "id": 10,
      "title": "Add detailed overdue payments object with time periods",
      "description": "Create new object outside counts containing detailed information for overdue payments organized by time periods (year, last month, current month)",
      "new_object_name": "overdue_payments_details",
      "location": "data (same level as counts)",
      "status": "blocked",
      "purpose": "Provide detailed information for all overdue payments organized by time periods with full rental and property details",
      "object_structure": {
        "total_overdue_count": 0,
        "total_overdue_amount": 0,
        "yearly_overview": {
          "year": 2025,
          "count": 0,
          "total_amount": 0,
          "payments": []
        },
        "last_month": {
          "month": "September 2025",
          "count": 0,
          "total_amount": 0,
          "payments": [
            {
              "rental_id": 126,
              "tenant_name": "Sara Mohammed",
              "tenant_phone": "+966501234570",
              "tenant_email": "sara.mohammed@email.com",
              "property": {
                "id": 48,
                "name": "Villa D-25",
                "unit_label": "Villa 25",
                "address": "101 King Fahd Road, Riyadh"
              },
              "contract": {
                "id": 70,
                "start_date": "2024-09-01",
                "end_date": "2025-09-01",
                "status": "active",
                "monthly_rent": 8000.0,
                "security_deposit": 16000.0
              },
              "payment_details": {
                "amount": 8000.0,
                "due_date": "2025-09-01",
                "currency": "SAR",
                "payment_type": "monthly_rent",
                "payment_status": "overdue",
                "days_overdue": 45,
                "overdue_penalty": 400.0
              },
              "rental_details": {
                "rental_amount": 8000.0,
                "currency": "SAR",
                "payment_frequency": "monthly"
              }
            }
          ]
        },
        "current_month": {
          "month": "October 2025",
          "count": 0,
          "total_amount": 0,
          "payments": [
            {
              "rental_id": 127,
              "tenant_name": "Omar Hassan",
              "tenant_phone": "+966501234571",
              "tenant_email": "omar.hassan@email.com",
              "property": {
                "id": 49,
                "name": "Office E-30",
                "unit_label": "Office 30",
                "address": "202 Business District, Riyadh"
              },
              "contract": {
                "id": 71,
                "start_date": "2024-10-01",
                "end_date": "2025-10-01",
                "status": "active",
                "monthly_rent": 12000.0,
                "security_deposit": 24000.0
              },
              "payment_details": {
                "amount": 12000.0,
                "due_date": "2025-10-01",
                "currency": "SAR",
                "payment_type": "monthly_rent",
                "payment_status": "overdue",
                "days_overdue": 15,
                "overdue_penalty": 600.0
              },
              "rental_details": {
                "rental_amount": 12000.0,
                "currency": "SAR",
                "payment_frequency": "monthly"
              }
            }
          ]
        }
      },
      "data_source": "All overdue payments from the system organized by time periods",
      "completion_message": "Task 10 completed. All tasks finished."
    }
  },
  "final_expected_counts_structure": {
    "ongoing_rentals": 26,
    "expiring_contracts_next_7d": 0,
    "expiring_contracts_current_month": 0,
    "expiring_contracts_next_month": 0,
    "payments_due_next_7d": 0,
    "payments_due_current_month": 0,
    "payments_due_next_month": 0,
    "payments_overdue": 0,
    "maintenance_open": 2,
    "maintenance_in_progress": 0
  },
  "final_expected_response_structure": {
    "status": true,
    "data": {
      "range_days": 7,
      "counts": {
        "ongoing_rentals": 26,
        "expiring_contracts_next_7d": 0,
        "expiring_contracts_current_month": 0,
        "expiring_contracts_next_month": 0,
        "payments_due_next_7d": 0,
        "payments_due_current_month": 0,
        "payments_due_next_month": 0,
        "payments_overdue": 0,
        "maintenance_open": 2,
        "maintenance_in_progress": 0
      },
      "payments_due_next_month_details": {
        "month": "November 2025",
        "count": 0,
        "total_amount": 0,
        "paid_count": 0,
        "paid_amount": 0,
        "unpaid_count": 0,
        "unpaid_amount": 0,
        "payments": []
      },
      "expiring_contracts_current_month_details": {
        "month": "October 2025",
        "count": 0,
        "contracts": []
      },
      "expiring_contracts_next_month_details": {
        "month": "November 2025",
        "count": 0,
        "contracts": []
      },
      "payments_due_current_month_details": {
        "month": "October 2025",
        "count": 0,
        "total_amount": 0,
        "paid_count": 0,
        "paid_amount": 0,
        "unpaid_count": 0,
        "unpaid_amount": 0,
        "payments": []
      },
      "overdue_payments_details": {
        "total_overdue_count": 0,
        "total_overdue_amount": 0,
        "yearly_overview": {
          "year": 2025,
          "count": 0,
          "total_amount": 0,
          "payments": []
        },
        "last_month": {
          "month": "September 2025",
          "count": 0,
          "total_amount": 0,
          "payments": []
        },
        "current_month": {
          "month": "October 2025",
          "count": 0,
          "total_amount": 0,
          "payments": []
        }
      },
      "property_stats": {},
      "contract_stats": {},
      "monthly_collections": {},
      "yearly_overview": {},
      "contracts_expiring": {},
      "ongoing_rentals": [],
      "reminders": [],
      "maintenance": []
    }
  },
  "implementation_notes": {
    "date_calculation": "Use actual month boundaries (e.g., October 1-31, November 1-30) not 30-day periods",
    "current_month": "Based on current date - if today is October 15, 2025, current month is October 2025",
    "next_month": "The month following current month - if current is October 2025, next is November 2025",
    "data_requirements": "Provide useful data for frontend dialog popups showing detailed information for each category"
  },
  "critical_review_requirements": {
    "title": "CRITICAL: Review existing monthly collection calculations",
    "description": "Review and fix existing total_to_collect_next_month and total_to_collect_this_month calculations",
    "issue": "These fields are currently calculated using 30-day periods instead of actual months",
    "required_fix": "Change calculation to use actual month boundaries (November, December, etc.) not 30-day periods",
    "fields_to_review": [
      "total_to_collect_this_month",
      "total_to_collect_next_month"
    ],
    "current_wrong_behavior": "Calculating from current date + 30 days (wrong)",
    "correct_behavior": "Calculate for actual current month (October 2025) and next month (November 2025)",
    "example": "If today is October 15, 2025: this_month = October 2025, next_month = November 2025 (not 30 days from today)"
  },
  "ai_instructions": {
    "start_with": "Begin with Task 1 ONLY. Do not proceed to other tasks.",
    "after_task_1": "After completing Task 1, stop and wait for user command 'اكمل وادخل في الtask التي بعدها'",
    "after_task_2": "After completing Task 2, stop and wait for user command 'اكمل وادخل في الtask التي بعدها'",
    "after_task_3": "After completing Task 3, stop and wait for user command 'اكمل وادخل في الtask التي بعدها'",
    "after_task_4": "After completing Task 4, stop and wait for user command 'اكمل وادخل في الtask التي بعدها'",
    "after_task_5": "After completing Task 5, stop and wait for user command 'اكمل وادخل في الtask التي بعدها'",
    "after_task_6": "After completing Task 6, stop and wait for user command 'اكمل وادخل في الtask التي بعدها'",
    "after_task_7": "After completing Task 7, stop and wait for user command 'اكمل وادخل في الtask التي بعدها'",
    "after_task_8": "After completing Task 8, stop and wait for user command 'اكمل وادخل في الtask التي بعدها'",
    "after_task_9": "After completing Task 9, stop and wait for user command 'اكمل وادخل في الtask التي بعدها'",
    "after_task_10": "After completing Task 10, announce that all tasks are finished",
    "user_commands": {
      "continue_arabic": "اكمل وادخل في الtask التي بعدها",
      "continue_english": "continue",
      "continue_short": "اكمل"
    },
    "strict_behavior": "NEVER proceed to next task without explicit user permission. Always wait for user command.",
    "critical_note": "Task 5 is CRITICAL - it fixes existing wrong calculations for monthly collections",
    "task_6_note": "Task 6 creates detailed object for frontend dialog popup with all payment details (next month)",
    "task_7_note": "Task 7 creates detailed object for frontend dialog popup with all contract details (current month)",
    "task_8_note": "Task 8 creates detailed object for frontend dialog popup with all contract details (next month)",
    "task_9_note": "Task 9 creates detailed object for frontend dialog popup with all payment details (current month)",
    "task_10_note": "Task 10 creates detailed object for overdue payments organized by time periods (year, last month, current month)"
  },
  "frontend_integration": {
    "dialog_requirements": "Frontend will create dialog popups similar to existing payments due dialog",
    "data_structure": "Ensure response includes detailed data for each new count field to populate dialog content",
    "note": "Frontend implementation is in separate project, only backend API response changes needed"
  }
}
